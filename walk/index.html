<!DOCTYPE html>
<html>
<head>
    <title>Collect My Hearts ‚ù§Ô∏è</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.4.2/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        .ui-overlay {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.8);
            padding: 10px 20px;
            border-radius: 20px;
            z-index: 1000;
            text-align: center;
            font-family: Arial, sans-serif;
        }
        #heartCount {
            color: #ff4081;
            font-weight: bold;
        }
        #completeMessage {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 64, 129, 0.9);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            display: none;
            z-index: 1000;
        }
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #fff0f3;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        .start-button {
            background: #ff4081;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="start-screen" id="startScreen">
        <h1>Heart Hunt! üíù</h1>
        <p>Find and collect all the floating hearts...</p>
        <button class="start-button" onclick="startGame()">Start Hunt!</button>
    </div>

    <div class="ui-overlay">
        Hearts collected: <span id="heartCount">0</span>/10
    </div>

    <div id="completeMessage">
        You found all the hearts!<br>
        Look at the pattern they made... üíù
    </div>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix;">
        <!-- Heart entities will be added here by JavaScript -->
        <a-camera gps-projected-camera rotation-reader></a-camera>
    </a-scene>

    <script>
        let heartsCollected = 0;
        const totalHearts = 10;
        let startPosition = null;

        function startGame() {
            document.getElementById('startScreen').style.display = 'none';
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(initializeHearts);
            }
        }

        function initializeHearts(position) {
            startPosition = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
            };

            // Create hearts in I ‚ù§Ô∏è U pattern
            const heartPositions = calculateHeartPositions(startPosition);
            
            heartPositions.forEach((pos, index) => {
                createHeart(pos.lat, pos.lng, index);
            });
        }

        function calculateHeartPositions(start) {
            const positions = [];
            const meterToLat = 0.00001;  // Approximate meter to latitude conversion
            const meterToLng = 0.00001;  // Approximate meter to longitude conversion

            // I pattern (vertical line)
            positions.push({ lat: start.lat + (2 * meterToLat), lng: start.lng });
            positions.push({ lat: start.lat + (4 * meterToLat), lng: start.lng });

            // Heart pattern
            positions.push({ lat: start.lat + (6 * meterToLat), lng: start.lng - (2 * meterToLng) });
            positions.push({ lat: start.lat + (6 * meterToLat), lng: start.lng + (2 * meterToLng) });
            positions.push({ lat: start.lat + (5 * meterToLat), lng: start.lng });

            // U pattern
            positions.push({ lat: start.lat + (2 * meterToLat), lng: start.lng + (4 * meterToLng) });
            positions.push({ lat: start.lat + (3 * meterToLat), lng: start.lng + (4 * meterToLng) });
            positions.push({ lat: start.lat + (4 * meterToLat), lng: start.lng + (4 * meterToLng) });

            return positions;
        }

        function createHeart(lat, lng, index) {
            const heart = document.createElement('a-entity');
            heart.setAttribute('gltf-model', '#heart-model');
            heart.setAttribute('scale', '0.5 0.5 0.5');
            heart.setAttribute('gps-projected-entity-place', {
                latitude: lat,
                longitude: lng
            });
            heart.setAttribute('animation', {
                property: 'position',
                dir: 'alternate',
                dur: 1000,
                easing: 'easeInOutSine',
                loop: true,
                from: '0 0 0',
                to: '0 0.5 0'
            });

            heart.addEventListener('click', () => collectHeart(heart));
            document.querySelector('a-scene').appendChild(heart);
        }

        function collectHeart(heart) {
            heart.parentNode.removeChild(heart);
            heartsCollected++;
            document.getElementById('heartCount').textContent = heartsCollected;

            if (heartsCollected === totalHearts) {
                showCompletion();
            }
        }

        function showCompletion() {
            document.getElementById('completeMessage').style.display = 'block';
            // Show final map with pattern
            // Add celebration effects
        }

        AFRAME.registerComponent('heart-collision', {
            tick: function() {
                // Check distance between camera and heart
                // Collect heart if close enough
            }
        });
    </script>
</body>
</html>