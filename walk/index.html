<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Heart Collector</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background: #000;
        }

        #container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .heart {
            position: absolute;
            font-size: 48px;
            user-select: none;
            transition: transform 0.3s ease-out;
            animation: float 2s infinite ease-in-out;
        }

        #score {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 20px;
        }

        #distance-indicator {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 16px;
            display: none;
        }

        #permission-prompt {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 1000;
            text-align: center;
            padding: 20px;
        }

        #start-button {
            margin-top: 20px;
            padding: 12px 24px;
            background: #ff4081;
            border: none;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-size: 16px;
        }

        .pop-animation {
            animation: pop 0.5s ease-out forwards !important;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.1); }
        }

        @keyframes pop {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.5; }
            100% { transform: scale(0); opacity: 0; }
        }

        .hint {
            color: #fff;
            text-align: center;
            padding: 10px;
            font-size: 14px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div id="permission-prompt">
        <h2>AR Heart Collector</h2>
        <p style="margin: 20px 0">Walk around to collect virtual hearts!</p>
        <button id="start-button">Start AR Experience</button>
    </div>

    <div id="score">‚ù§Ô∏è <span id="count">0</span></div>
    <div id="distance-indicator"></div>

    <div id="container">
        <video id="video" autoplay playsinline></video>
    </div>

    <script>
        const video = document.getElementById('video');
        const container = document.getElementById('container');
        const countDisplay = document.getElementById('count');
        const permissionPrompt = document.getElementById('permission-prompt');
        const startButton = document.getElementById('start-button');
        const distanceIndicator = document.getElementById('distance-indicator');
        
        let count = 0;
        let hearts = [];
        const maxHearts = 2;

        startButton.addEventListener('click', startAR);

        async function startAR() {
            try {
                // Request high-quality back camera
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'environment',
                        width: { ideal: 1920 },
                        height: { ideal: 1080 },
                        frameRate: { ideal: 60 }
                    }
                });

                video.srcObject = stream;
                permissionPrompt.style.display = 'none';
                
                // Start spawning hearts
                spawnHearts();
                
                // Start checking distances
                setInterval(checkHeartDistances, 100);

            } catch (err) {
                console.error('Camera error:', err);
                alert('Could not access camera. Please ensure camera permissions are granted.');
            }
        }

        function spawnHearts() {
            if (hearts.length < maxHearts) {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.innerHTML = '‚ù§Ô∏è';
                heart.style.left = `${Math.random() * 80 + 10}%`;
                heart.style.top = `${Math.random() * 60 + 20}%`;
                
                // Store the heart's position relative to screen center
                heart.dataset.offsetX = Math.random() * 200 - 100; // -100 to 100
                heart.dataset.offsetY = Math.random() * 200 - 100; // -100 to 100
                
                container.appendChild(heart);
                hearts.push(heart);

                // Update heart position based on device orientation
                updateHeartPosition(heart);
            }
        }

        function checkHeartDistances() {
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;

            hearts.forEach(heart => {
                const rect = heart.getBoundingClientRect();
                const heartX = rect.left + rect.width / 2;
                const heartY = rect.top + rect.height / 2;
                
                const distance = Math.sqrt(
                    Math.pow(heartX - centerX, 2) + 
                    Math.pow(heartY - centerY, 2)
                );

                // If heart is close to center of screen (camera)
                if (distance < 100) {
                    collectHeart(heart);
                }

                // Update distance indicator
                if (distance < 300) {
                    distanceIndicator.style.display = 'block';
                    distanceIndicator.textContent = 'Getting closer! üî•';
                    if (distance < 150) {
                        distanceIndicator.textContent = 'Almost there! ‚ú®';
                    }
                } else {
                    distanceIndicator.style.display = 'none';
                }
            });
        }

        function collectHeart(heart) {
            if (!heart.classList.contains('pop-animation')) {
                count++;
                countDisplay.textContent = count;
                heart.classList.add('pop-animation');
                
                setTimeout(() => {
                    heart.remove();
                    hearts = hearts.filter(h => h !== heart);
                    spawnHearts();
                }, 500);
            }
        }

        // Handle device orientation for more realistic AR feeling
        if (window.DeviceOrientationEvent) {
            window.addEventListener('deviceorientation', handleOrientation);
        }

        function handleOrientation(event) {
            hearts.forEach(heart => updateHeartPosition(heart, event));
        }

        function updateHeartPosition(heart, orientation) {
            if (orientation) {
                const offsetX = parseFloat(heart.dataset.offsetX);
                const offsetY = parseFloat(heart.dataset.offsetY);
                
                // Adjust position based on device orientation
                const beta = orientation.beta || 0;  // Front/back tilt
                const gamma = orientation.gamma || 0; // Left/right tilt
                
                const adjustedX = offsetX + (gamma * 2);
                const adjustedY = offsetY + (beta * 2);
                
                heart.style.transform = `translate(${adjustedX}px, ${adjustedY}px)`;
            }
        }

        // Spawn new hearts periodically
        setInterval(() => {
            if (hearts.length < maxHearts) {
                spawnHearts();
            }
        }, 3000);
    </script>
</body>
</html>